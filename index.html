<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flight Booking System</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
  <style>
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .center-card {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card {
      width: 100%;
      max-width: 350px;
      border-radius: 16px;
      box-shadow: 0 0.5rem 1rem rgba(0,0,0,.05);
    }
  </style>
</head>
<body class="bg-light">

  <!-- Login/Signup Card (centered) -->
  <div class="center-card" id="authCard">
    <div class="card p-4">
      <!-- Login Form -->
      <div id="loginDiv">
        <h3 class="text-center mb-3">Login</h3>
        <input type="email" id="loginEmail" class="form-control mb-3" placeholder="Email" />
        <input type="password" id="loginPassword" class="form-control mb-3" placeholder="Password" />
        <button onclick="login()" class="btn btn-primary w-100 mb-2">Login</button>
        <p class="text-center mb-0">Don't have an account? <a href="#" onclick="toggleForms()">Sign up</a></p>
      </div>
      <!-- Signup Form -->
      <div id="signupDiv" class="d-none">
        <h3 class="text-center mb-3">Sign Up</h3>
        <input type="email" id="signupEmail" class="form-control mb-3" placeholder="Email" />
        <input type="password" id="signupPassword" class="form-control mb-3" placeholder="Password" />
        <button onclick="signup()" class="btn btn-success w-100 mb-2">Sign Up</button>
        <p class="text-center mb-0">Already have an account? <a href="#" onclick="toggleForms()">Login</a></p>
      </div>
    </div>
  </div>

  <!-- Booking Form + Bookings Table (Only visible when logged in) -->
  <div class="container mt-5 d-none" id="bookingDiv">
    <h2 class="mb-3">Book a Flight</h2>
    <input type="text" id="from" class="form-control mb-2" placeholder="From" />
    <input type="text" id="to" class="form-control mb-2" placeholder="To" />
    <input type="date" id="date" class="form-control mb-2" />
    <input type="number" id="passengers" class="form-control mb-2" placeholder="No. of Passengers" />
    <button onclick="bookFlight()" class="btn btn-primary w-100 mb-2">Book</button>
    <button onclick="logout()" class="btn btn-danger w-100">Logout</button>
    
    <!-- Bookings Table -->
    <div class="mt-5" id="bookingList">
      <h3>Your Booked Flights</h3>
      <table class="table table-striped" id="bookedFlightsTable">
        <thead>
          <tr>
            <th>From</th>
            <th>To</th>
            <th>Date</th>
            <th>Passengers</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="bookedFlights"></tbody>
      </table>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // Firebase config - replace with your actual project config
    const firebaseConfig = {
      apiKey: "AIzaSyBnrtX5rzyGtzfkqVuxhXEccmC1WxgUxsE",
      authDomain: "flightticketbooking-35580.firebaseapp.com",
      projectId: "flightticketbooking-35580",
      storageBucket: "flightticketbooking-35580.firebasestorage.app",
      messagingSenderId: "828504592232",
      appId: "1:828504592232:web:bec4c555c0e8d7fe4e10dd"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // UI elements
    const authCard = document.getElementById("authCard");
    const loginDiv = document.getElementById("loginDiv");
    const signupDiv = document.getElementById("signupDiv");
    const bookingDiv = document.getElementById("bookingDiv");

    function toggleForms() {
      loginDiv.classList.toggle("d-none");
      signupDiv.classList.toggle("d-none");
    }

    auth.onAuthStateChanged(user => {
      if (user) {
        authCard.classList.add("d-none");
        bookingDiv.classList.remove("d-none");
        fetchBookings();
      } else {
        authCard.classList.remove("d-none");
        bookingDiv.classList.add("d-none");
        // Always show login form by default when logged out
        loginDiv.classList.remove("d-none");
        signupDiv.classList.add("d-none");
      }
    });

    function login() {
      const email = document.getElementById("loginEmail").value;
      const password = document.getElementById("loginPassword").value;
      auth.signInWithEmailAndPassword(email, password)
        .catch(error => alert("Login Error: " + error));
    }

    function signup() {
      const email = document.getElementById("signupEmail").value;
      const password = document.getElementById("signupPassword").value;
      auth.createUserWithEmailAndPassword(email, password)
        .then(() => alert("Account created! You can now log in."))
        .catch(error => alert("Signup Error: " + error));
    }

    function logout() {
      auth.signOut();
    }

    function bookFlight() {
      const from = document.getElementById("from").value;
      const to = document.getElementById("to").value;
      const date = document.getElementById("date").value;
      const passengers = document.getElementById("passengers").value;
      const user = auth.currentUser;

      if (!from || !to || !date || !passengers) {
        alert("Please fill all the fields.");
        return;
      }

      db.ref("bookings").push({
        userId: user.uid,
        from,
        to,
        date,
        passengers,
        bookedAt: new Date().toISOString()
      }).then(() => {
        alert("Flight booked successfully!");
        fetchBookings(); // Refresh the list after booking
      }).catch(error => {
        alert("Booking error: " + error);
      });
    }

    // Cancel booking function
    function cancelBooking(key) {
      if (confirm("Are you sure you want to cancel this booking?")) {
        db.ref("bookings/" + key).remove()
          .then(() => {
            alert("Booking cancelled.");
            fetchBookings(); // Refresh the table
          })
          .catch(error => {
            alert("Error cancelling booking: " + error);
          });
      }
    }

    // Fetch and display bookings
    function fetchBookings() {
      const user = auth.currentUser;
      if (!user) return;
      db.ref("bookings").orderByChild("userId").equalTo(user.uid).on("value", snapshot => {
        const bookedFlights = snapshot.val();
        const bookedFlightsTable = document.getElementById("bookedFlights");
        bookedFlightsTable.innerHTML = "";

        if (bookedFlights) {
          for (const key in bookedFlights) {
            const flight = bookedFlights[key];
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${flight.from}</td>
              <td>${flight.to}</td>
              <td>${flight.date}</td>
              <td>${flight.passengers}</td>
              <td>
                <button class="btn btn-danger btn-sm" onclick="cancelBooking('${key}')">Cancel</button>
              </td>
            `;
            bookedFlightsTable.appendChild(tr);
          }
        } else {
          bookedFlightsTable.innerHTML = '<tr><td colspan="5">No flights booked yet.</td></tr>';
        }
      });
    }
  </script>
</body>
</html>
